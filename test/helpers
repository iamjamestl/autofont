#
# autofont -- Test Helpers
# Copyright (C) 2017 James T. Lee
#
# This software may be modified and distributed under the terms
# of the MIT license.  See the LICENSE file for details.
#
# Functions that may be useful in all of the test scripts.
#

# Skip exit status modeled after:
# https://www.gnu.org/software/automake/manual/html_node/Scripts_002dbased-Testsuites.html
SKIP=77

configure() {
    TESTING=true autofont/configure "$@"
    configure_status="$?"
    results_dir="$(dirname "$RESULTS")"
    [[ -d $results_dir ]] || mkdir -p "$results_dir"
    echo "CONFIGURE_STATUS='$configure_status'" >> "$RESULTS"
}

configure_with_build_deps() {
    which python > /dev/null || exit $SKIP
    configure --enable-build-dependencies "$@"
}

configure_with_fixtures_and_build_deps() {
    configure_with_build_deps --with-font-srcdir=../../fixtures/Hack "$@"
}

configure_with_fixtures() {
    configure --with-font-srcdir=../../fixtures/Hack "$@"
}

make_fake_ufo() {
    local path="$1"
    local name="$2"

    mkdir -p "$path"

    cat > "${path}/fontinfo.plist" <<FONTINFO
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
    <dict>
        <key>familyName</key>
        <string>${name}</string>
    </dict>
</plist>
FONTINFO

    cat > "${path}/metainfo.plist" <<METAINFO
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
    <dict>
        <key>formatVersion</key>
        <integer>2</integer>
    </dict>
</plist>
METAINFO
}

# vi: ft=sh
